C51 COMPILER V9.54   CLOCK                                                                 12/01/2021 23:18:17 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE CLOCK
OBJECT MODULE PLACED IN .\Objects\clock.obj
COMPILER INVOKED BY: C:\Program Files\Keil_v5\C51\BIN\C51.EXE clock.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(
                    -.\Listings\clock.lst) TABS(2) OBJECT(.\Objects\clock.obj)

line level    source

   1          #include "reg51.h"
   2          
   3          sbit RS = P3^0;
   4          sbit RW = P3^1;
   5          sbit E = P3^2;
   6          // unsigned char str[] = {"hello world"};
   7          
   8          unsigned char count = 0;
   9          unsigned int hour = 23, min = 59, sec = 50;
  10          unsigned char strNum[] = {"0123456789"};
  11          
  12          // Âª∂Êó∂ÂáΩÊï∞
  13          void delay (unsigned int n)
  14          {
  15   1        unsigned int i=0,j=0;
  16   1        for (i = 0; i < n; i++)
  17   1        {
  18   2          for(j=0;j<120;j++);
  19   2        }
  20   1      }
  21          
  22          // ÂÜôÂëΩ‰ª§
  23          void wireCommand(unsigned char com) {
  24   1          RS = 0; // ‰ΩéÁîµÂπ≥ÂºÄÂßãÂÜôÂëΩ‰ª§   È´òÁîµÂπ≥ÂÜôÊï∞ÊçÆ
  25   1          RW = 0; // ‰ΩéÁîµÂπ≥‰∏∫ ÂÜôÔºå È´òÁîµÂπ≥‰∏∫ËØª 
  26   1          E = 0;  // ‰ΩøËÉΩ Á´Ø ‰∏ãÈôçÊ≤øÊúâÊïàÔºõ  Ê†πÊçÆÊó∂Â∫èÂõæ  ÂàùÂßã‰ΩéÁîµÂπ≥ÔºåÁÑ∂ÂêéÊãâÈ´òÁîµÂπ≥ Ââç Êî
             -æÂÖ• Êï∞ÊçÆ
  27   1          P2 = com; // ÈÄöËøá P2Â≠òÂÖ•Êï∞ÊçÆ
  28   1          delay(5);
  29   1          E = 1; // ÊãâÈ´òÁîµÂπ≥ ÂºÄÂßãÂÜôÂÖ•Êï∞ÊçÆÔºå ÁÑ∂Âêé  Êï∞ÊçÆ‰º†ËæìÂÆåÊàê Êãâ‰Ωé
  30   1          E = 0; // Êãâ‰ΩéÁîµÂπ≥ Êï∞ÊçÆÂÜôÂÖ•ÂÆåÊàêÔºå
  31   1      }
  32          
  33          // ÂÜôÊï∞ÊçÆ
  34          void wireData(unsigned char dat){
  35   1          RS = 1; // ‰ΩéÁîµÂπ≥ÂºÄÂßãÂÜôÂëΩ‰ª§   È´òÁîµÂπ≥ÂÜôÊï∞ÊçÆ
  36   1          RW = 0; // ‰ΩéÁîµÂπ≥‰∏∫ ÂÜôÔºå È´òÁîµÂπ≥‰∏∫ËØª 
  37   1          E = 0;  // ‰ΩøËÉΩ Á´Ø ‰∏ãÈôçÊ≤øÊúâÊïàÔºõ  Ê†πÊçÆÊó∂Â∫èÂõæ  ÂàùÂßã‰ΩéÁîµÂπ≥ÔºåÁÑ∂ÂêéÊãâÈ´òÁîµÂπ≥ Ââç Êî
             -æÂÖ• Êï∞ÊçÆ
  38   1          P2 = dat;// ÈÄöËøá P2Â≠òÂÖ•Êï∞ÊçÆ
  39   1          delay(5);
  40   1          E = 1; // ÊãâÈ´òÁîµÂπ≥ ÂºÄÂßãÂÜôÂÖ•Êï∞ÊçÆÔºå ÁÑ∂Âêé  Êï∞ÊçÆ‰º†ËæìÂÆåÊàê Êãâ‰Ωé
  41   1          E = 0; // Êãâ‰ΩéÁîµÂπ≥ Êï∞ÊçÆÂÜôÂÖ•ÂÆåÊàêÔºå
  42   1      }
  43          
  44          void initLcd(){
  45   1          // ÂÜôÂÖ•ÂëΩ‰ª§ 
  46   1          // 00111000  ËÆæÁΩÆ16 * 2ÊòæÁ§∫Ôºå 5*7ÁÇπÈòµÔºå 8‰ΩçÊï∞ÊçÆÊé•Âè£
  47   1          wireCommand(0x38);
  48   1          // 0x0C  00001100 ËÆæÁΩÆÂºÄÊòæÁ§∫Ôºå ‰∏çÊòæÁ§∫ÂÖâÊ†á
  49   1          wireCommand(0x0C);
  50   1          // ÂÜô‰∏Ä‰∏™Â≠óÁ¨¶ÂêéÂú∞ÂùÄÊåáÈíà Âä†‰∏Ä
  51   1          wireCommand(0x06);
  52   1          // ÊòæÁ§∫Ê∏ÖÈõ∂ Êï∞ÊçÆÊåáÈíàÊ∏ÖÈõ∂
C51 COMPILER V9.54   CLOCK                                                                 12/01/2021 23:18:17 PAGE 2   

  53   1          wireCommand(0x01);
  54   1      
  55   1      }
  56          
  57          
  58          void display(){
  59   1          // wireCommand(0x80);
  60   1          // delay(5);
  61   1          // wireData('K');
  62   1          // delay(5);
  63   1          // wireData('i');
  64   1          // delay(5);
  65   1          // // ÈÄöËøá ask Á†Å ÊòæÁ§∫Êï∞ÊçÆ
  66   1          // wireData(0x31);
  67   1          // delay(5);
  68   1          // // wireData(0111000); ÈîôËØØÁöÑÊñπÂºè
  69   1          // // wireCommand(0x80 + 2);
  70   1          // wireCommand(0x80 + 2 + 0x40);
  71   1          // // "\0" Ë°®Á§∫ÁªìÊùüÁ¨¶
  72   1          // while (str[j]!='\0')
  73   1          // {
  74   1          //     /* code */
  75   1          //     wireData(str[j]);
  76   1          //     delay(5);
  77   1          //     j++; 
  78   1          // }
  79   1          unsigned char temp0 = 0, temp1 = 0, temp2 = 0, temp3 = 0, temp4 = 0, temp5 = 0;
  80   1          temp0 = hour/10;
  81   1          temp1 = hour%10;
  82   1      
  83   1          temp2 = min/10;
  84   1          temp3 = min%10;
  85   1      
  86   1          temp4 = sec/10;
  87   1          temp5 = sec%10;
  88   1      
  89   1      
  90   1      
  91   1          wireCommand(0x80);
  92   1          delay(5);
  93   1          wireData(strNum[temp0]);
  94   1          delay(5);
  95   1          wireData(strNum[temp1]);
  96   1          delay(5);
  97   1          wireData(':');
  98   1          delay(5);
  99   1          wireData(strNum[temp2]);
 100   1          delay(5);
 101   1          wireData(strNum[temp3]);
 102   1          delay(5);
 103   1          wireData(':');
 104   1          delay(5);
 105   1          wireData(strNum[temp4]);
 106   1          delay(5);
 107   1          wireData(strNum[temp5]);
 108   1          
 109   1      }
 110          
 111          void initTime(){
 112   1          
 113   1          TMOD = 0x01; // 0000 0001 ÂÆöÊó∂Âô®0 16‰ΩçÂÆöÊó∂Âô®
 114   1          TH0 = (65536 - 50000)/256; // 20ms = 50000us;  256 = 2 ^ 8;  ÂàùÂÄº>> 8  
C51 COMPILER V9.54   CLOCK                                                                 12/01/2021 23:18:17 PAGE 3   

 115   1          TL0 = (65536 - 50000)%256;
 116   1          // printf("TH0: %d TH0: %d \n", TH0, TL0);
 117   1          ET0 = 1; //ÂÆöÊó∂Âô®0 ÂºÄÂêØÁªà‰∏≠Êñ≠
 118   1          EA = 1; // ÂºÄÂêØÊÄª‰∏≠Êñ≠
 119   1          TR0 = 1; //ÂêØÂä®ÂÆöÊó∂Âô® 0
 120   1      
 121   1      }
 122          
 123          // ÂàõÂª∫
 124          
 125          int main()
 126          {
 127   1          // ÂàùÂßãÂåñLCD
 128   1          initLcd();
 129   1          // ÂàùÂßãÂåñÂÆöÊó∂Âô®
 130   1          initTime();
 131   1          /* code */
 132   1          while (1)
 133   1          {
 134   2              /* ÊòæÁ§∫Êï∞ÂÄº */
 135   2              display();
 136   2          }
 137   1          
 138   1      }
 139          
 140          
 141          // Â§ñÈÉ®‰∏≠Êñ≠0: 0 ; ÂÆöÊó∂Âô®‰∏≠Êñ≠1: 1; Â§ñÈÉ®‰∏≠Êñ≠1: 2; ÂÆöÊó∂Âô®‰∏≠1:3; ‰∏≤Âè£‰∏≠Êñ≠: 4;
 142          void timeIser() interrupt 1{
 143   1          TH0 = (65536 - 50000)/256;  
 144   1          TL0 = (65536 - 50000)%256;
 145   1          count++;
 146   1          if(count == 20) {
 147   2              sec = sec + 1;
 148   2              count = 0;
 149   2          }
 150   1          if(sec == 60) {
 151   2              min = min + 1;
 152   2              sec =0;
 153   2          }
 154   1          if(min == 60) {
 155   2              hour = hour + 1;
 156   2              min =0;
 157   2          }
 158   1          if(hour == 24) {
 159   2              hour =0;
 160   2          }
 161   1      }
 162          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    371    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     18       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
