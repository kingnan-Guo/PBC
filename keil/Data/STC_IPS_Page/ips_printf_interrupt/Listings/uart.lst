C51 COMPILER V9.54   UART                                                                  03/29/2022 00:41:35 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE UART
OBJECT MODULE PLACED IN .\Objects\uart.obj
COMPILER INVOKED BY: C:\Program Files\Keil_v5\C51\BIN\C51.EXE uart.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.
                    -\Listings\uart.lst) TABS(2) OBJECT(.\Objects\uart.obj)

line level    source

   1          /**
   2           * @file uart.c
   3           * @author your name (you@domain.com)
   4           * @brief 
   5           * @version 0.1
   6           * @date 2022-03-28
   7           * 
   8           * @copyright Copyright (c) 2022
   9           * 
  10           */
  11           
  12          #include "reg51.h"
  13          #include "uart.h"
  14          
  15          
  16          #include "delay.h"
  17          
  18          // int main(int argc, char const *argv[])
  19          // {
  20              
  21          //     return 0;
  22          // }
  23          
  24          
  25          
  26          void uartInit(void){
  27   1          // PCON &= 0x7F; // 0111 1111
  28   1          // 工作在方式 2  8位波特率 固定
  29   1          SCON = 0x50; // M0 M1 M2 GEN    TB8  RB8 TI RI = 0101 0000
  30   1          // T1 作为 波特率 发生器 ；工作在 方式 1 作为 8位 可重载
  31   1      
  32   1          //  4800 = (1/32) * (foc/ 12 )* [1/(256 - X)]
  33   1          // x = 6 TH1 = 0xFA; TL1 = 0xFA; 
  34   1          //  9600 = (1/32) * (foc/ 12 )* [1/(256 - X)]
  35   1          // x = 3
  36   1          TMOD = 0x20;// GATE_1 C/T M1_1 M0_1    GATE_0 C/T M1_0 M0_0  
  37   1          // TH1 = 0xFD; // 9600 的波特率 
  38   1          // TL1 = 0xFD;
  39   1          TH1 = 0xFA; 
  40   1          TL1 = 0xFA;
  41   1          ET1 = 0;//禁止 定时计数器 T1 中断
  42   1          TR1 = 1;//启动定时器1 
  43   1          EA = 1;//开启总中断
  44   1          ES = 1;//串口中断
  45   1      } 
  46          
  47          
  48          // void sendSBUF(){
  49          
  50          // }
  51          
  52          
  53          // void uart_ISR() interrput 4 using 0{
  54          //     SBUF = ""
C51 COMPILER V9.54   UART                                                                  03/29/2022 00:41:35 PAGE 2   

  55          // }
  56          
  57          
  58          // void uart_ISR() interrupt 4 {
  59          //     // SBUF = ""   
  60          //     if(TI){
  61          //         TI = 0;
  62          //     }
  63          // }
  64          
  65          // 串口 中断
  66          // 将 SBUF 装填数据并发送后 会进入到中断的程序 中 ，
  67          // 将 TI  清零 后，允许下一次中断 
  68          // 新的数据 发送给 SBUF ，发送后 再次 进入中断
  69          
  70          void uart_ISR() interrupt 4 {
  71   1          // SBUF = ""   
  72   1          if(TI){
  73   2              // DelayXms(2000); // 延时 1s
  74   2              
  75   2              DelayXms(2000);
  76   2              TI = 0;
  77   2              send(0x88);
  78   2          }
  79   1          
  80   1      }
  81          
  82          // 中断进入后 再次 进入 send
  83          
  84          void send(unsigned char dat){
  85   1      
  86   1          SBUF = dat;
  87   1      }
  88          
  89          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     97    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
