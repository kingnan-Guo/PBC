C51 COMPILER V9.54   I2C                                                                   02/13/2022 23:33:56 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE I2C
OBJECT MODULE PLACED IN .\Objects\I2C.obj
COMPILER INVOKED BY: C:\Program Files\Keil_v5\C51\BIN\C51.EXE I2C.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\
                    -Listings\I2C.lst) TABS(2) OBJECT(.\Objects\I2C.obj)

line level    source

   1          /**
   2           * @file I2C.c
   3           * @author kingnan (github.com/kingnan-Guo/PBC)
   4           * @brief I2C 的时序与逻辑 
   5           * @version 0.1
   6           * @date 2022-02-12
   7           * 
   8           * @copyright Copyright (c) 2022
   9           * 
  10           */
  11          
  12          #include "I2C.h"
  13          
  14          
  15          //延时
  16          void IIC_delay(void)
  17          {
  18   1        u8 t=1;
  19   1        while(t--);
  20   1      }
  21          
  22          // ------- 起始信号 --------
  23          // 89C51 没有I2C， 所以使用模拟时序操作 I2C
  24          // SCL 在高电平过程中， SDA 有下降沿，这时 开启了I2C
  25          // void I2C_star() {
  26          //     SDA = 1;
  27          //     SCL = 1;
  28          //     delay(5); // 延时5us, 时间要大于 4.7us， 
  29          //     SDA = 0; // 将SDA处于低电平，开始 I2C
  30          //     delay(5); // 时间要大于额 4us
  31          //     SCL = 0;
  32          // }
  33          void I2C_Start(void)
  34          {
  35   1        OLED_SDA_Set();
  36   1        OLED_SCL_Set();
  37   1        IIC_delay();
  38   1        OLED_SDA_Clr();
  39   1        IIC_delay();
  40   1        OLED_SCL_Clr();
  41   1      }
  42          
  43          
  44          // -------  结束信号 ---------
  45          // void I2C_stop() {
  46          //     SCL = 0;
  47          //     SDA = 0;
  48          //     delay(5);
  49          //     SCL = 1;
  50          //     delay(5);
  51          //     SDA = 1; // 当 SCL 为高电平的情况下， SDA为高电平；
  52          //     delay(5);
  53          //     SDA = 0;
  54          // }
C51 COMPILER V9.54   I2C                                                                   02/13/2022 23:33:56 PAGE 2   

  55          void I2C_Stop(void)
  56          {
  57   1        OLED_SDA_Clr();
  58   1        OLED_SCL_Set();
  59   1        IIC_delay();
  60   1        OLED_SDA_Set();
  61   1      }
  62          
  63          
  64          // ---- 等待信号响应 -----
  65          // // 发送非应答位
  66          // void unAsk() {
  67          //     SDA = 1; // 当SCL为高电平的时候，SDA为1，所以 非应答为 1
  68          //     delay(5); // 持续时间 大于 4us
  69          //     SCL = 1;
  70          //     delay(5); // 持续时间 大于 4us
  71          //     SCL = 0;
  72          //     delay(5); // 持续时间 大于 4us
  73          //     SDA = 0;
  74          // }
  75          void I2C_WaitAck(void) //测数据信号的电平
  76          {
  77   1        OLED_SDA_Set();
  78   1        IIC_delay();
  79   1        OLED_SCL_Set();
  80   1        IIC_delay();
  81   1        OLED_SCL_Clr();
  82   1        IIC_delay();
  83   1      }
  84          
  85          
  86          
  87          
  88          //写入一个字节
  89          // void sendByte(unsigned char dat){
  90          //     unsigned char i;
  91          //     SCL = 0;
  92          //     for (i = 0; i < 8; i++)
  93          //     {
  94                  
  95          //         SDA = dat & 0x80;
  96          //         SCL = 1;
  97          //         delay(5);
  98          //         SCL = 0;
  99          //         dat <<= 1;
 100          //     }
 101              
 102          // }
 103          
 104          void Send_Byte(u8 dat)
 105          {
 106   1        u8 i;
 107   1        for(i=0;i<8;i++)
 108   1        {
 109   2          OLED_SCL_Clr();//将时钟信号设置为低电平
 110   2          if(dat&0x80){//将dat的8位从最高位依次写入
 111   3            OLED_SDA_Set();
 112   3              }
 113   2          else {
 114   3            OLED_SDA_Clr();
 115   3              }
 116   2          IIC_delay();
C51 COMPILER V9.54   I2C                                                                   02/13/2022 23:33:56 PAGE 3   

 117   2          OLED_SCL_Set();
 118   2          IIC_delay();
 119   2          OLED_SCL_Clr();
 120   2          dat<<=1;
 121   2        }
 122   1      }
 123          
 124          
 125          
 126          
 127          
 128          
 129          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     84    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
